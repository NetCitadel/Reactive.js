<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Dirty Fields</title>
  <script src="reactive.js"></script>
	<script src="reactive.static.js"></script>
  <script src="reactive.function.js"></script>
	<script src="reactive.event.js"></script>
	<script src="reactive.element.js"></script>
  <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>-->
  <!--[if IE]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style>
  html, body {height:100%; width:100%; margin:0; padding:0;}
  body {background: -webkit-gradient(linear, center top, center bottom, from(#d7d5d5), to(#fffcfd));
        font-family: Helvetica, Arial, sans-serif;}
  #wrapper {padding-top:50px; margin:0 auto; width:200px; text-align:center;}
  .dirty {background: #bfbfbf;}
  .allocation {width:50px;text-align:center;}
  #alloc-table {width:200px;}
  #alloc-table td{-webkit-box-shadow:inset 0px 0px 10px #fffcfd; border:1px solid grey;}
  </style>
</head>
<body>
  <div id="wrapper">
    <h1 id="changes">Changes: <span id="count">0</span></h1>
    <input type="checkbox" id="lock">
    <table id="alloc-table">
      <tr class="alloc-row">
        <td><input class="allocation" id="first" type="text" value="123"></td>
      </tr>
      <tr class="alloc-row">
        <td><input class="allocation" id="second" type="text" value="456"></td>
      </tr>
      <tr class="alloc-row">
        <td><input class="allocation" id="third" type="text" value="789"></td>
      </tr>
    </table>
    <button id="submit" disabled>Submit</button>
  </div>

  <script>
	
	//Constant = DOM.Element • DOM.Attribute -> Constant
	//Constant = Object -> Constant
	//Reactive.Value = Constant • DOM.Event -> Constant
	//Reactive.Value = Constant • Event -> Constant
	//Reactive.Value = Constant -> Constant
	//Reactive.Behavior = Reactive.Value • TFunc -> Reactive.Value?
	
	//What about AJAX? Custom events would be useful. microevents.js?
	//In that case...
	//Constant = Object • Property -> Constant //Necessary because DOM events fire on objects?
	//Constant = Javascript Literal -> Constant
	//Reactive.Value = Constant • Event -> Constant //"Future Constant"
	//Reactive.Behavior = Reactive.Value • TFunc -> Reactive.Value?
	
	//Extensions
	//Reactive.Collection = Array<Reactive.Value> • <∑Reactive.Value.Event> -> Array<Constant> 
	//Or Reactive.Value(array, Reactive.Event.Group(array))
	
	var rows = document.getElementsByClassName("alloc-row");
	var inputFields = document.getElementsByClassName("allocation");
	
	//The disabled property of our submit button
	var submitDisabledAttr = Reactive.Value(document.getElementById("submit"), "disabled");
	
	//The checked state of our lock checkbox
	var lockChecked = Reactive.Value(document.getElementById("lock"), "checked", "change");
	
	//The inner html of our change count <span>
	var changeCountHtml = Reactive.Value(document.getElementById("changes"), "innerHtml");
	
	//A behavior that creates a value representing the dirty state of a field
	var isDirty = Reactive.Behavior(function(defaultVal, val) {
		return defaultVal === val;
	});
	
	var arr = [];
	for(var i=0,len=inputFields.length; i<len; i++) {
		//We bind the behavior to the "defaultValue" of this input
		//and the current "value" of the input. 
		//bind() returns a new Reactive.Value that represents the dirty state this field.
		arr.push(isDirty.bind({defaultVal:Reactive.Value(inputFields[i], "defaultValue"), 
																		val:Reactive.Value(inputFields[i], "value", "change");}));
		
		//row state should be here too?
	}
	//A Reactive value representing an array of dirty states
	var dirtyOrClean = Reactive.Value(arr, Reactive.Event.Bundle(arr));
	
	//A value representing the number of changes to our form
	var numChanges = Reactive.Behavior(function(dirtyStates) {
		var i=0;
		for (len=dirtyStates.length;i<len;i++) {
			if (dirtyStates[i]) break;
		}
		return i;
	}).bind({dirtyStates:dirtyOrClean});
	
	//A value representing the computed disabled state of our button
	//(the form may be locked, or there may be no changes)
	var buttonIsDisabled = Reactive.Behavior(function(locked, numChanges) {
		return locked || numChanges > 0;
	}).bind({locked:lockChecked, numChanges:numChanges});
	
	//Assign the disabled property of our submit button to the buttonIsDisabled value we computed
	submitDisabled.equals(buttonIsDisabled); //i.e. Reactive.Value = Reactive.Value

	//A behavior that creates a value representing the appropriate class for a row
	var rowState = Reactive.Behavior(function(dirtyState) {
		return dirtyState ? "dirty" : "clean";
	});	
	
	for(var i=0,len=rows.length;i<len;i++) {
		//Assign this rows class property to the row state value
		Reactive.Value(rows[i], "class").equals(rowState.bind({dirtyState:dirtyOrClean.get(i)}));
	}
	
	//Assign the change count inner html to the number of changes value
	changeCount.equals(numChanges);
	
	var rowClicked = Reactive.Value(document.getElementById("row"), "click");
	var rowOn....
	var subRowVisibility = Reactive.Value(document.getElementById("subRow"));
	
	subRowVisibility.equals(rowClickedOn);
	
	//a more basic demo should show math with some events based on a timer
  </script>
<!-- Powered by Little People - Mickey Mouse Operation -->
</body>
</html>